<html>
  <head>
    <meta charset="utf-8">

<script>

function init() {
  window.addEventListener("message", function process(e) {runNextTest(e)}, false);
}

var i = 0;
function runNextTest(e) {
  if (e.data.type != "prefs" && e.data.type != "payload")
    return;

  var tests = ["DisableDataSubmission","RequestCurrentPrefs","RequestCurrentPayload","EnableDataSubmission"];
  sendToBrowser(tests[i]);
  dispatchMessage(tests[i]);
  i++;
}

function dispatchMessage(cmd) {
  var data = {command: cmd};
  window.parent.postMessage(data, "*");
}

function sendToBrowser(type) {
  var event = new CustomEvent("RemoteHealthReportCommand", {detail: {command: type}, bubbles: true});
  document.dispatchEvent(event);
}

</script>
  </head>
  <body onload="init()">
  </body>
</html>
