<!DOCTYPE HTML>
<html>



  <head>
    <title>Test for feed discovery</title>

    
    <link rel="alternate" type="application/atom+xml" title="1" href="/1.atom" />
    <link rel="alternate" type="application/rss+xml" title="2" href="/2.rss" />
    <link rel="feed" title="3" href="/3.xml" />

    
    <link rel=" alternate " type="application/atom+xml" title="4" href="/4.atom" />
    <link rel="foo alternate" type="application/atom+xml" title="5" href="/5.atom" />
    <link rel="alternate foo" type="application/atom+xml" title="6" href="/6.atom" />
    <link rel="foo alternate foo" type="application/atom+xml" title="7" href="/7.atom" />
    <link rel="meat feed cake" title="8" href="/8.atom" />

    
    <link rel="ALTERNate" type="application/atom+xml" title="9" href="/9.atom" />
    <link rel="fEEd" title="10" href="/10.atom" />

    
    <link rel="alternate" type="  application/atom+xml  " title="11" href="/11.atom" />

    
    <link rel="alternate" type="aPPliCAtion/ATom+xML" title="12" href="/12.atom" />

    
    <link rel="alternate" type="application/rdf+xml" title="13 rss" href="/13.rdf" />

    
    <link rel="alternate" type="application/xml" title="14 rss" href="/14.xml" />

    
    <link rel="alternate" type="text/xml" title="15 rss" href="/15.xml" />

    
    <link rel="feed stylesheet" title="16" href="/16.atom" />

    
    <link rel="disabled-alternate" type="application/atom+xml" title="Bogus1" href="/Bogus1" />
    <link rel="alternates" type="application/atom+xml" title="Bogus2" href="/Bogus2" />
    <link rel=" alternate-like" type="application/atom+xml" title="Bogus3" href="/Bogus3" />

    
    <link rel="alternate" type="text/xml" title="Bogus4 scissorsshaped" href="/Bogus4" />

    
    <link rel="alternate" type="application/xml" title="Bogus5 scissorsshaped" href="/Bogus5" />

    
    <link rel="alternate" type="application/rdf+xml" title="Bogus6 scissorsshaped" href="/Bogus6" />

    
    <link rel="alternate" type="text/plain" title="Bogus7 rss" href="/Bogus7" />

    
    <link rel="foopy" type="application/atom+xml" title="Bogus8 Atom and RSS" href="/Bogus8" />

    
    <link rel="goats" type="application/rss+xml" title="Bogus9 RSS and Atom" href="/Bogus9" />

    
    <link rel="alternate stylesheet" type="application/rss+xml" title="Bogus10 RSS" href="/Bogus10" />
  </head>
  <body>
    <script type="text/javascript">
      window.onload = function() {
        netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");

        var tests = new Array();

        var currentWindow =
        window.QueryInterface(Components.interfaces.nsIInterfaceRequestor)
                              .getInterface(Components.interfaces.nsIWebNavigation)
                              .QueryInterface(Components.interfaces.nsIDocShellTreeItem)
                              .rootTreeItem
                              .QueryInterface(Components.interfaces.nsIInterfaceRequestor)
                              .getInterface(Components.interfaces.nsIDOMWindow);
        var browser = currentWindow.gBrowser.selectedBrowser;

        var discovered = browser.feeds;
        tests.push({ check: discovered.length > 0,
                     message: "some feeds should be discovered" });

        var feeds = [];

        for each (var aFeed in discovered) {
          feeds[aFeed.href] = true;
        }

        for each (var aLink in document.getElementsByTagName("link")) {
          // ignore real stylesheets, and anything without an href property
          if (aLink.type != "text/css" && aLink.href) {
            if (/bogus/i.test(aLink.title)) {
              tests.push({ check: !feeds[aLink.href],
                           message: "don't discover " + aLink.href });
            } else {
              tests.push({ check: feeds[aLink.href],
                           message: "should discover " + aLink.href });
            }
          }
        }
        window.arguments[0].tests = tests;
        window.close();
      }
    </script>
  </body>
</html>

