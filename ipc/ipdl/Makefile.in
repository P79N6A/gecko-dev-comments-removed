# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

DEPTH = @DEPTH@
topsrcdir = @top_srcdir@
srcdir = @srcdir@
VPATH = @srcdir@

include $(DEPTH)/config/autoconf.mk

GARBAGE_DIRS += _ipdlheaders
GARBAGE += ipdl_lextab.py ipdl_yacctab.py $(wildcard *.pyc $(srcdir)/ipdl/*.pyc $(srcdir)/ipdl/cxx/*.pyc)

EXPORT_LIBRARY = 1

# This file is generated by the moz.build backend.
include ipdlsrcs.mk

GARBAGE += $(CPPSRCS)

LOCAL_INCLUDES += -I$(DEPTH)/ipc/ipdl/_ipdlheaders


include $(topsrcdir)/config/rules.mk
include $(topsrcdir)/ipc/chromium/chromium-config.mk


# NB: the IPDL compiler manages .ipdl-->.h/.cpp dependencies itself,
# which is why we don't have explicit .h/.cpp targets here
ipdl: $(ALL_IPDLSRCS)
	$(PYTHON) $(topsrcdir)/config/pythonpath.py \
	  $(PLY_INCLUDE) \
	  $(srcdir)/ipdl.py \
	  --outheaders-dir=_ipdlheaders \
	  --outcpp-dir=. \
	  $(IPDLDIRS:%=-I%) \
	  $^

.PHONY: ipdl

# We #include some things in the dom/plugins/ directory that rely on
# toolkit libraries.
CXXFLAGS    += $(TK_CFLAGS)

# This is only needed to support |make| from this leaf directory/Makefile.
NONRECURSIVE_TARGETS := export
NONRECURSIVE_TARGETS_export := ipdl
NONRECURSIVE_TARGETS_export_ipdl_DIRECTORY := .
NONRECURSIVE_TARGETS_export_ipdl_TARGETS := ipdl
